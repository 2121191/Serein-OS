# Serein V3.0 项目摘要

## 项目概述

Serein 是基于华中科技大学 HUST-OS/xv6-k210 移植的增强版操作系统内核。在其基础上，我开发了四个主要版本（V1.0 → V2.0 → V2.3 → V3.0），贡献了约 10,000 行内核代码。

## 开发时间线

```
华科 Baseline → V1.0 → V2.0 → V2.3 → V3.0
     ↓           ↓       ↓       ↓       ↓
   起点       CoW     mmap    缓冲     poll
             Lazy    信号    分桶    alarm
            Stride   共享内存         clone
             信号量  PID哈希        Shell增强
```

## 各版本贡献

### V1.0: 核心内存与调度
- Copy-on-Write (CoW): fork 时不复制页面，性能提升 16 倍
- Lazy Allocation: 堆增长时按需分配页面
- POSIX 信号量: 带等待队列的进程同步
- Stride 调度: 确定性公平份额 CPU 调度
- QEMU 支持: 双平台运行（K210 硬件 + QEMU 模拟器）
- 新增约 3,000 行代码

### V2.0: 高级功能
- mmap/munmap: 支持 MAP_SHARED/MAP_PRIVATE 的内存映射文件
- 信号系统: 完整 POSIX 信号（32 种信号、处理器、sigreturn）
- 共享内存: 命名共享内存段
- PID 哈希表: kill() 的 O(1) 进程查找
- UID/GID 权限: 基础 Unix 权限机制
- 新增约 4,000 行代码

### V2.3: 优化
- 分桶缓冲区: 13 个哈希桶减少 I/O 锁争用
- 非阻塞 I/O: 管道和文件的 O_NONBLOCK 支持
- FAT32 优化: 分配提示、稀疏索引
- 新增约 1,000 行代码

### V3.0: POSIX 兼容与用户体验
- poll(): 多文件描述符的 I/O 多路复用
- alarm(): 基于定时器的 SIGALRM 传递
- fcntl(): 文件描述符控制
- clone()/futex(): 基础线程支持
- Shell 增强: 命令历史（↑↓）、Tab 补全、光标导航（←→）
- 新增约 1,500 行代码

## 技术统计

| 指标 | 数值 |
|------|------|
| 代码贡献 | 约 10,000 行 |
| 系统调用 | 67 个 |
| 测试用例 | 70+ |
| 测试通过率 | 100% |

## 关键创新

1. 两阶段 Stride 调度: 无锁扫描 + 加锁验证，避免死锁
2. 每 CPU 内存分配器: CPU 间工作窃取
3. FAT32 稀疏索引: 大文件定位 O(n/128)
4. UART 环形缓冲: 中断上下半部分离

## 性能提升

| 操作 | 优化前 | 优化后 | 提升 |
|------|--------|--------|------|
| fork 10MB 进程 | 80ms | 5ms (CoW) | 16 倍 |
| kill() 查找 | O(N) | O(1) (哈希) | 50 倍 |
| 大文件定位 | O(n) | O(n/128) | 128 倍 |

## 平台支持

- 硬件: K210 双核 RISC-V（8MB RAM, SD 卡）
- 模拟器: QEMU riscv64-virt + VirtIO

## 总结

从华科基线出发，我开发了一个功能丰富的嵌入式 OS 内核，具备现代 Unix 能力：虚拟内存优化（CoW、Lazy、mmap）、公平份额调度（Stride）、完整 IPC 机制（信号量、共享内存、信号）以及 POSIX 兼容功能（poll、alarm、fcntl、线程）。

---

*2026 年 1 月*
